<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receita</title>
    <link rel="stylesheet" href="assets/styling/style.css">
</head>

<body>
    <div id="qrcode"></div>
    <h1 id="title"></h1>

    <div class="recipe-header">
        <div>
            <div class="chip" id="difficulty"></div>
            <div class="chip"><span class="material">room_service</span><p id="amount"></p></div>
            <div class="chip"><span class="material">schedule</span><p id="time"></p></div>
            <button class="chip print" onclick="print()"><span class="material">print</span><p>Imprimir</p></button>
        </div>
        <div id="description">
        </div>
    </div>

    <div class="wavy-line"></div>

    <h2>Ingredientes</h2>
    <div id="ingredients">
    </div>

    <div class="wavy-line"></div>

    <h2>Modo de preparo</h2>
    <div id="steps">
    </div>

    <script type="text/javascript" src="./assets/qrcode.min.js"></script>
    <script type="module">
        import {marked} from "./assets/marked.esm.js"

        fetch(`./${decodeURI(top.window.location.search.substr(1))}.json`)
            .then(res => res.json())
            .then(json => {
                document.getElementById("title").innerHTML = json.title;
                document.getElementById("description").insertAdjacentHTML("beforeend", json.description.map(entry => {
                    return `${marked.parse(entry)}`
                }).join(""));
                document.getElementById("amount").innerHTML = json.amount;
                document.getElementById("time").innerHTML = json.time;

                if (json.difficulty == "easy") {
                    document.getElementById("difficulty").innerHTML = `
                        <div>
                            <span class="material">star</span>
                        </div>
                        <p id="difficulty">Fácil</p>
                    `
                    document.getElementById("difficulty").classList.add("easy")
                }
                else if (json.difficulty == "medium") {
                    document.getElementById("difficulty").innerHTML = `
                        <div>
                            <span class="material">star</span>
                            <span class="material">star</span>
                        </div>
                        <p id="difficulty">Médio</p>
                    `
                    document.getElementById("difficulty").classList.add("medium")
                }
                else {
                    document.getElementById("difficulty").innerHTML = `
                        <div>
                            <span class="material">star</span>
                            <span class="material">star</span>
                            <span class="material">star</span>
                        </div>
                        <p id="difficulty">Difícil</p>
                    `
                    document.getElementById("difficulty").classList.add("hard")
                }

                const ingredients = document.getElementById("ingredients");
                if (json.custom) {
                    for (const [key, value] of Object.entries(json.ingredients)) {
                        ingredients.insertAdjacentHTML("beforeend",
                            `<div class="section">
                                <h3>${value["title"]}</h3>
                                ${value["items"].map(element => {
                                    return `<label><input type="checkbox"><span>${element}</span></label>`
                                }).join("")}
                            </div>`);
                    }
                }
                else {
                    ingredients.insertAdjacentHTML("beforeend", `<div class="section"></div>`);
                    json.ingredients.forEach(element => {
                        document.getElementsByClassName("section")[0].insertAdjacentHTML("beforeend",
                            `<label><input type="checkbox"><span>${element}</span></label>`
                        )
                    })
                }

                if (json.special != "") {
                    ingredients.insertAdjacentHTML("beforeend",
                        `<div class="section" id="special">
                                        <p><b>Equipamento especial:  </b>${json.special}</p>
                                    </div>`
                    )
                }

                let count = 1;
                json.steps.forEach(element => {
                    document.getElementById("steps").insertAdjacentHTML("beforeend",
                        `<div><h2>${count}.</h2>${marked.parse(element)}</div>`
                    )
                    count += 1;
                });
            }
            );
        
        new QRCode(document.getElementById("qrcode"), top.window.location.href)
    </script>
</body>

</html>