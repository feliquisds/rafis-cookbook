<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receita</title>
    <link rel="stylesheet" href="assets/styling/style.css">
</head>

<body>
    <h1 id="title"></h1>
    
    <div class="recipe-header">
        <div>
            <div class="chip"><span class="material">room_service</span><p id="amount"></p></div>
            <div class="chip"><span class="material">schedule</span><p id="time"></p></div>
            <button class="chip print"><span class="material">print</span><p>Imprimir</p></button>
        </div>
        <p id="description"></p>
    </div>

    <div class="wavy-line"></div>
    
    <div id="ingredients">
        <h2>Ingredientes</h2>
    </div>

    <div class="wavy-line"></div>
    
    <div id="steps">
        <h2>Passos</h2>
    </div>

    <script>
        function loadContent(url) {
            var hash = url.substr(1);
            fetch(`./${hash}.json`)
                    .then(res => res.json())
                    .then(json => 
                        {
                            document.getElementById("title").innerHTML = json.title;
                            document.getElementById("description").innerHTML = json.description;
                            document.getElementById("amount").innerHTML = json.amount;
                            document.getElementById("time").innerHTML = json.time;
                            
                            const ingredients = document.getElementById("ingredients");
                            if (json.ingredients.count == 1) {
                                ingredients.insertAdjacentHTML("beforeend", `<div class="section"></div>`);
                                json.ingredients.sections.forEach(element => {
                                    document.getElementsByClassName("section")[0].insertAdjacentHTML("beforeend",
                                        `<label><input type="checkbox"><span>${element}</span></label>`
                                    )
                                })
                            }
                            else {
                                //TODO
                            }
    
                            if (json.special != null) {
                                ingredients.insertAdjacentHTML("beforeend", 
                                    `<div id="special">
                                        <h3>Equipamento especial:</h3>
                                        <p>${json.special}</p>
                                    </div>`
                                )
                            }
    
                            let count = 1;
                            json.steps.forEach(element => {
                                document.getElementById("steps").insertAdjacentHTML("beforeend", 
                                    `<div><h2>${count}.</h2><p>${element}</p></div>`
                                )
                                count += 1;
                            });
    
                            if (json.notes != null) {
                                document.body.insertAdjacentHTML("beforeend", 
                                    `<div class="wavy-line"></div>
    
                                    <div id="notes">
                                        <h2>Informação adicional</h2>
                                    </div>`
                                )
                                json.notes.forEach(element => {
                                    document.getElementById("notes").insertAdjacentHTML("beforeend",
                                        `<p>${element}</p>`
                                    )
                                });
                            }
                        }
                    );
        }

        function findRecipe() {
            const recipe = top.window.location.hash.substr(1).split("/");
            top.document.getElementById(recipe[0]).children[0].children[0].checked = true;
            top.document.getElementById(recipe[1]).classList.add("selected");
        }

        loadContent(top.window.location.hash);
        findRecipe();
        top.addEventListener("hashchange", (event) => window.location.reload())
    </script>
</body>

</html>